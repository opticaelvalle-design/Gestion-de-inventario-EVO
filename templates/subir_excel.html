{% extends "base.html" %}
{% block title %}Subir Excel · Gestión de Inventario EVO{% endblock %}
{% block content %}
<div class="content-header">
    <div>
        <h2>Pedidos mediante Excel</h2>
        <p>Prepara tus pedidos con el formato estándar y súbelos en XLSX para acelerar la carga de líneas.</p>
    </div>
    <div class="meta">
        <strong>Formato requerido</strong>
        <p>La plantilla y las exportaciones usan las columnas: <em>pedido</em>, <em>cliente</em>, <em>codigo</em>, <em>cantidad</em>.</p>
    </div>
</div>

<section class="card" style="display: grid; gap: 1.25rem; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); align-items: start;">
    <div>
        <h3 class="section-title" style="margin-top: 0;">Descargar plantilla pedidos</h3>
        <p>Obtén el archivo base con el orden y nombres de columnas correctos.</p>
        <a class="button-link" href="{{ url_for('descargar_plantilla_excel') }}">Descargar plantilla pedidos</a>
    </div>

    <form method="post" enctype="multipart/form-data" novalidate>
        <h3 class="section-title" style="margin-top: 0;">Subir pedidos en XLSX</h3>
        <p>Selecciona un archivo Excel con los pedidos listos para cargar.</p>
        <label for="archivo">Archivo</label>
        <input type="file" id="archivo" name="archivo" accept=".xlsx" required />
        <input type="submit" value="Subir pedidos en XLSX" />
    </form>

    <div>
        <h3 class="section-title" style="margin-top: 0;">Descargar pedidos en XLSX</h3>
        <p>Exporta los pedidos existentes al mismo formato para revisar o actualizar.</p>
        <a class="button-link" href="{{ url_for('descargar_pedidos_excel') }}">Descargar pedidos en XLSX</a>
    </div>
</section>

{% if resumen %}
    <h3 class="section-title">Resumen del archivo</h3>
    <table>
        <tbody>
            <tr>
                <th>Nombre</th>
                <td>{{ resumen.nombre }}</td>
            </tr>
            <tr>
                <th>Tamaño aproximado</th>
                <td>{{ resumen.tamano_kb }} KB</td>
            </tr>
            <tr>
                <th>Estado</th>
                <td>{% if resumen.procesado %}Procesado correctamente{% else %}Pendiente{% endif %}</td>
            </tr>
            <tr>
                <th>Pedidos detectados</th>
                <td>{{ resumen.pedidos_detectados }}</td>
            </tr>
            <tr>
                <th>Filas procesadas</th>
                <td>{{ resumen.filas_procesadas }}</td>
            </tr>
            <tr>
                <th>Filas omitidas</th>
                <td>{{ resumen.filas_omitidas }}</td>
            </tr>
            <tr>
                <th>Pedidos creados</th>
                <td>{{ resumen.pedidos_creados }}</td>
            </tr>
            <tr>
                <th>Líneas nuevas</th>
                <td>{{ resumen.lineas_creadas }}</td>
            </tr>
            <tr>
                <th>Líneas actualizadas</th>
                <td>{{ resumen.lineas_actualizadas }}</td>
            </tr>
        </tbody>
    </table>
{% endif %}
{% endblock %}
